<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"
      name="viewport">
  <link crossorigin="anonymous"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
        rel="stylesheet">
  <title>나의 메뉴</title>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<header>
  <div th:replace="/global/navbar :: navbar"></div>
</header>
<body>
<div style="padding:10px;width:1000px; height:min-content; margin:auto">
  <div id="post" post="${postId}"></span></div>
  <div id="menus" style="width:1000px; height:min-content;"></div>
  <div id="addmenu" style="padding:10px;width:1000px;height:min-content;">
    <div id="addmenubtn">
      <button class="btn btn-outline-secondary" menuId=${menu.id} onclick="dropAddMenu()"
              type="button">메뉴 추가
      </button>
    </div>

    <div id="dropaddmenu">
      <div className="input-group">
        <span className="input-group-text">메뉴 이름</span>
        <input aria-label="메뉴 이름" className="form-control" id="menuname" placeholder="메뉴 이름"
               type="text">
        <span className="input-group-text">메뉴 가격</span>
        <input aria-label="메뉴 가격" className="form-control" id="menuprice" placeholder="메뉴 가격"
               type="text">
      </div>
      <button className="btn btn-outline-secondary" onClick="addMenu()"
              type="button">추가
      </button>
    </div>

  </div>
</div>

<script th:inline="javascript">

  $(document).ready(function () {
    getData();
  });

  function getData() {

    let idForPost = [[${postId}]];

    $.ajax({
      type: 'GET',
      url: `/api/v1/menus`,
      dataType: "json",
      contentType: 'application/json',
      data: {
        postId: idForPost
      },
      success: function (response) {
        console.log('Success:', response);
        if(response.status !== 200){
          alert(response.message);
        }
        drawMenus(response.data);
        $('#dropaddmenu').css('visibility', 'hidden');

      },
      error: function (error) {
        console.error('Error:', error);
      }
    });
  }

  function drawMenus(data) {
    data.forEach((menu) =>
        $('#menus').append(
            `
  <div>
    <span>${menu.menuname}</span>
    <span>${menu.price}</span>
    <button class="btn btn-outline-secondary" menuId=${menu.id} onclick="deleteMenu(this)"
            type="button">삭제
    </button>
  </div>
  `
        )
    )
  }

  function dropAddMenu() {
    var dropAddMenuElement = $('#dropaddmenu');

    if (dropAddMenuElement.css('visibility') === 'hidden') {
      dropAddMenuElement.css('visibility', 'visible');
    } else {
      dropAddMenuElement.css('visibility', 'hidden');
    }
  }

  function addMenu() {

    let name = $('#menuname').val();
    let price = $('#menuprice').val();
    let postId = [[${postId}]];

    $.ajax({
      type: 'POST',
      url: "/api/v1/menus",
      dataType: "json",
      contentType: 'application/json',
      data: JSON.stringify({
        postId: postId,
        name: name,
        price: price
      }),
      success: function (response) {
        console.log('Success:', response);
        alert(response.message);
      },
      error: function (error, response) {
        alert(response.message);
        console.error('Error:', error);
      }
    });

    location.reload();

  }

  function deleteMenu(button) {

    let menuId = $(button).attr("menuId");

    $.ajax({
      type: 'DELETE',
      url: "/api/v1/menus",
      dataType: "json",
      contentType: 'application/json',
      data: JSON.stringify({
        menuId: menuId
      }),
      success: function (response) {
        console.log('Success:', response);
        alert(response.message);
      },
      error: function (error, response) {
        alert(response.message);
        console.error('Error:', error);
      }
    });

    location.reload();

  }


</script>
</body>
</html>